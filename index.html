<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SportGame</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<style>
body{
  margin:0;
  font-family:Arial;
  background: linear-gradient(rgba(0,0,0,0.65), rgba(0,0,0,0.65)),
              url('IMG_4544.jpeg') no-repeat center center fixed;
  background-size: cover;
  color:white;
}

header{
  background:rgba(28,43,54,0.9);
  padding:15px;
  text-align:center;
  font-size:20px;
}

nav{
  position:fixed;
  bottom:0;
  width:100%;
  background:rgba(28,43,54,0.95);
  display:flex;
  justify-content:space-around;
  padding:10px 0;
}

nav button{
  background:none;
  border:none;
  color:white;
  font-size:14px;
}

.section{
  display:none;
  padding:20px;
  padding-bottom:100px;
  min-height:100vh;
}

.active{
  display:block;
}

input,button,select,textarea{
  padding:10px;
  margin:5px 0;
  border-radius:8px;
  border:none;
  width:100%;
}

button{
  background:#1c2b36;
  color:white;
  cursor:pointer;
}

#map{
  height:400px;
  border-radius:10px;
  margin-top:10px;
}
</style>
</head>

<body>

<header>SportGame</header>

<div style="padding:20px; background:rgba(0,0,0,0.6);">
  <h3>Acceso</h3>
  <input type="email" id="loginEmail" placeholder="Email">
  <input type="password" id="loginPassword" placeholder="Contrase√±a">
  <button onclick="iniciarSesion()">Iniciar sesi√≥n</button>
  <button onclick="registrarse()">Registrarse</button>
  <button onclick="cerrarSesion()">Cerrar sesi√≥n</button>
  <p id="usuarioActivo"></p>
</div>

<div id="home" class="section active">
  <h2>Bienvenido</h2>
  <p>Encuentra compa√±eros deportivos cerca de ti.</p>
</div>

<div id="mapSection" class="section">
  <h2>Mapa geolocalizador</h2>
  <button onclick="obtenerUbicacion()">Mostrar mi ubicaci√≥n</button>
  <div id="map"></div>
</div>

<div id="profile" class="section">
  <h2>Mi perfil</h2>
  <input type="text" id="perfilNombre" placeholder="Nombre">
  <select id="perfilMunicipio">
    <option value="">Selecciona municipio</option>
    <option>Las Palmas</option>
    <option>Santa Cruz de Tenerife</option>
    <option>La Laguna</option>
    <option>Telde</option>
  </select>
  <input type="text" id="perfilDeporte" placeholder="Deporte favorito">
  <button onclick="guardarPerfil()">Guardar perfil</button>
</div>

<div id="contact" class="section">
  <h2>Contacto</h2>
  <input type="text" id="contactoNombre" placeholder="Tu nombre">
  <input type="email" id="contactoEmail" placeholder="Tu email">
  <textarea id="contactoMensaje" placeholder="Tu mensaje"></textarea>
  <button onclick="enviarMensajeContacto()">Enviar</button>
</div>

<nav>
  <button onclick="showSection('home')">üè† Inicio</button>
  <button onclick="showSection('mapSection')">üó∫Ô∏è Mapa</button>
  <button onclick="showSection('profile')">üë§ Perfil</button>
  <button onclick="showSection('contact')">üì© Contacto</button>
</nav>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { 
  getAuth, 
  createUserWithEmailAndPassword, 
  signInWithEmailAndPassword,
  signOut,
  onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

import { 
  getFirestore, 
  doc, 
  setDoc, 
  collection, 
  addDoc 
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAiw_ozqt7wuDIQQk-YR9gKtgRShQM_ifY",
  authDomain: "sportgame-64bf1.firebaseapp.com",
  projectId: "sportgame-64bf1",
  storageBucket: "sportgame-64bf1.firebasestorage.app",
  messagingSenderId: "644038182748",
  appId: "1:644038182748:web:f8eae86bb743c868436399",
  measurementId: "G-6LSFB9ZDFK"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

window.registrarse = async function(){
  try{
    await createUserWithEmailAndPassword(auth,loginEmail.value,loginPassword.value);
    alert("Usuario registrado ‚úÖ");
  }catch(e){ alert(e.message); }
}

window.iniciarSesion = async function(){
  try{
    await signInWithEmailAndPassword(auth,loginEmail.value,loginPassword.value);
    alert("Sesi√≥n iniciada ‚úÖ");
  }catch(e){ alert(e.message); }
}

window.cerrarSesion = async function(){
  await signOut(auth);
  alert("Sesi√≥n cerrada");
}

onAuthStateChanged(auth,(user)=>{
  usuarioActivo.innerText = user 
    ? "Conectado como: "+user.email 
    : "No has iniciado sesi√≥n";
});

window.guardarPerfil = async function(){
  const user = auth.currentUser;
  if(!user){ alert("Inicia sesi√≥n primero"); return; }

  await setDoc(doc(db,"usuarios",user.uid),{
    nombre:perfilNombre.value,
    municipio:perfilMunicipio.value,
    deporte:perfilDeporte.value,
    email:user.email,
    fecha:new Date()
  });

  alert("Perfil guardado üî•");
}

window.enviarMensajeContacto = async function(){
  await addDoc(collection(db,"mensajesContacto"),{
    nombre:contactoNombre.value,
    email:contactoEmail.value,
    mensaje:contactoMensaje.value,
    fecha:new Date()
  });

  alert("Mensaje enviado ‚úÖ");
}

let map;

window.obtenerUbicacion = function(){
  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(pos=>{
      const lat = pos.coords.latitude;
      const lng = pos.coords.longitude;

      if(!map){
        map = L.map('map').setView([lat,lng],13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
          attribution:'¬© OpenStreetMap'
        }).addTo(map);
      }

      L.marker([lat,lng]).addTo(map)
        .bindPopup("Est√°s aqu√≠ üìç")
        .openPopup();
    });
  }else{
    alert("Geolocalizaci√≥n no soportada");
  }
}

window.showSection = function(id){
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

</script>

</body>
</html>
