<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SportGame</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}

body{
  background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:white;
  min-height:100vh;
}

nav{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:20px 60px;
}

.logo{font-size:24px;font-weight:800;}

.menu{display:flex;gap:30px;}

.menu a{color:white;text-decoration:none;cursor:pointer;}
.menu a:hover{color:#ff7a00;}

.section{display:none;padding:60px;}
.active{display:block;}

.btn{
  background:#ff7a00;
  padding:12px 25px;
  border:none;
  border-radius:30px;
  font-weight:bold;
  color:white;
  cursor:pointer;
}

.login-box{
  background:rgba(255,255,255,0.1);
  padding:30px;
  border-radius:20px;
  max-width:400px;
  backdrop-filter:blur(10px);
}

input{
  width:100%;
  padding:12px;
  margin:10px 0;
  border:none;
  border-radius:10px;
}

.card{
  max-width:400px;
  margin:auto;
  background:white;
  color:black;
  border-radius:20px;
  overflow:hidden;
}

.card img{
  width:100%;
  height:350px;
  object-fit:cover;
}

.card-info{
  padding:20px;
}

.acciones{
  display:flex;
  justify-content:space-around;
  padding:20px;
}

.acciones button{
  font-size:22px;
  border:none;
  border-radius:50%;
  width:60px;
  height:60px;
  cursor:pointer;
}

footer{text-align:center;padding:30px;opacity:0.7;margin-top:60px;}
#map{height:300px;margin-top:30px;border-radius:20px;}
</style>
</head>

<body>

<nav>
  <div class="logo">‚öΩ SportGame</div>
  <div class="menu">
    <a onclick="showSection('principal')">Principal</a>
    <a onclick="showSection('people')">People</a>
    <a onclick="showSection('jugador')">Jugador</a>
  </div>
</nav>

<!-- PRINCIPAL -->
<div id="principal" class="section active">
  <h1>Bienvenido a SportGame</h1>
</div>

<!-- PEOPLE -->
<div id="people" class="section">
  <h2>Encuentra jugadores</h2>

  <div class="card">
    <img id="fotoJugador" src="https://i.pravatar.cc/400">
    <div class="card-info">
      <h2 id="nombreJugador"></h2>
      <p id="distanciaJugador"></p>
    </div>

    <div class="acciones">
      <button onclick="rechazar()">‚ùå</button>
      <button onclick="darLike()">‚ù§Ô∏è</button>
      <button onclick="favorito()">‚≠ê</button>
    </div>
  </div>

  <div id="map"></div>
</div>

<!-- JUGADOR -->
<div id="jugador" class="section">
  <h2>Perfil del Jugador</h2>
  <input type="text" id="perfilNombre" placeholder="Nombre">
  <input type="text" id="perfilDeporte" placeholder="Deporte favorito">
  <button class="btn" onclick="guardarPerfil()">Guardar Perfil</button>
</div>

<footer>¬© 2026 SportGame</footer>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth,onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { 
  getFirestore, collection, getDocs, addDoc, 
  doc, setDoc, query, where 
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAiw_ozqt7wuDIQQk-YR9gKtgRShQM_ifY",
  authDomain: "sportgame-64bf1.firebaseapp.com",
  projectId: "sportgame-64bf1",
  storageBucket: "sportgame-64bf1.firebasestorage.app",
  messagingSenderId: "644038182748",
  appId: "1:644038182748:web:f8eae86bb743c868436399"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let jugadores=[];
let indexActual=0;
let miUbicacion=null;
let map;

/* GEOLOCALIZACI√ìN */
navigator.geolocation.getCurrentPosition(pos=>{
  miUbicacion={
    lat:pos.coords.latitude,
    lng:pos.coords.longitude
  };
});

/* DISTANCIA */
function calcularDistancia(lat1,lon1,lat2,lon2){
  const R=6371;
  const dLat=(lat2-lat1)*Math.PI/180;
  const dLon=(lon2-lon1)*Math.PI/180;
  const a=Math.sin(dLat/2)**2+
    Math.cos(lat1*Math.PI/180)*
    Math.cos(lat2*Math.PI/180)*
    Math.sin(dLon/2)**2;
  const c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
  return (R*c).toFixed(1);
}

/* CARGAR JUGADORES */
async function cargarJugadores(){
  const snap=await getDocs(collection(db,"jugadores"));
  jugadores=snap.docs.map(doc=>({id:doc.id,...doc.data()}));
  mostrarJugador();
  cargarMapa();
}

/* MOSTRAR TARJETA */
function mostrarJugador(){
  if(jugadores.length===0)return;
  const j=jugadores[indexActual];

  nombreJugador.innerText=j.nombre || "Jugador";
  fotoJugador.src=j.foto || "https://i.pravatar.cc/400?u="+j.id;

  if(j.lat && miUbicacion){
    const dist=calcularDistancia(
      miUbicacion.lat,miUbicacion.lng,
      j.lat,j.lng
    );
    distanciaJugador.innerText=dist+" km de distancia";
  }
}

/* LIKE */
window.darLike=async function(){
  const j=jugadores[indexActual];
  await addDoc(collection(db,"likes"),{
    from:auth.currentUser.uid,
    to:j.id
  });
  comprobarMatch(j.id);
  siguiente();
}

/* MATCH */
async function comprobarMatch(idDestino){
  const q=query(collection(db,"likes"),
    where("from","==",idDestino),
    where("to","==",auth.currentUser.uid)
  );
  const snap=await getDocs(q);
  if(!snap.empty) alert("üî• ¬°MATCH!");
}

/* RECHAZAR */
window.rechazar=function(){ siguiente(); }
window.favorito=function(){ alert("‚≠ê A√±adido a favoritos"); }

function siguiente(){
  indexActual++;
  if(indexActual<jugadores.length) mostrarJugador();
}

/* MAPA */
function cargarMapa(){
  if(!miUbicacion)return;

  map=L.map('map').setView([miUbicacion.lat,miUbicacion.lng],12);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
    attribution:'¬© OpenStreetMap'
  }).addTo(map);

  L.marker([miUbicacion.lat,miUbicacion.lng])
    .addTo(map).bindPopup("T√∫");

  jugadores.forEach(j=>{
    if(j.lat)
      L.marker([j.lat,j.lng]).addTo(map)
      .bindPopup(j.nombre);
  });
}

/* GUARDAR PERFIL */
window.guardarPerfil=async function(){
  const user=auth.currentUser;
  if(!user)return alert("Inicia sesi√≥n");

  await setDoc(doc(db,"jugadores",user.uid),{
    nombre:perfilNombre.value,
    deporte:perfilDeporte.value,
    lat:miUbicacion?.lat || null,
    lng:miUbicacion?.lng || null,
    fecha:new Date()
  });

  alert("Perfil guardado");
}

/* NAV */
window.showSection=function(id){
  document.querySelectorAll('.section')
    .forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  if(id==="people") cargarJugadores();
}

</script>

</body>
</html>
